<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sims-like Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
        }
        #ui {
            position: absolute;
            bottom: 0;
            width: 100%;
            background-color: rgba(0, 0, 102, 0.7);
            color: white;
            padding: 10px;
            display: flex;
            justify-content: space-between;
        }
        .stats {
            display: flex;
            flex-direction: column;
            width: 70%;
        }
        .stat-row {
            display: flex;
            margin-bottom: 5px;
        }
        .stat-name {
            width: 80px;
        }
        .stat-bar-container {
            width: 150px;
            height: 15px;
            background-color: #333;
            border-radius: 3px;
            margin-left: 10px;
        }
        .stat-bar {
            height: 100%;
            border-radius: 3px;
        }
        .controls {
            display: flex;
            flex-direction: column;
            width: 30%;
            align-items: flex-end;
        }
        #instructions {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="instructions">
        Click on the ground to move the character<br>
        WASD or Arrow Keys to rotate camera<br>
        Mouse wheel to zoom
    </div>
    <div id="ui">
        <div class="stats">
            <div class="stat-row">
                <div class="stat-name">Hunger</div>
                <div class="stat-bar-container">
                    <div id="hunger-bar" class="stat-bar" style="width: 75%; background-color: #4CAF50;"></div>
                </div>
            </div>
            <div class="stat-row">
                <div class="stat-name">Energy</div>
                <div class="stat-bar-container">
                    <div id="energy-bar" class="stat-bar" style="width: 60%; background-color: #2196F3;"></div>
                </div>
            </div>
            <div class="stat-row">
                <div class="stat-name">Fun</div>
                <div class="stat-bar-container">
                    <div id="fun-bar" class="stat-bar" style="width: 40%; background-color: #9C27B0;"></div>
                </div>
            </div>
            <div class="stat-row">
                <div class="stat-name">Social</div>
                <div class="stat-bar-container">
                    <div id="social-bar" class="stat-bar" style="width: 55%; background-color: #FF9800;"></div>
                </div>
            </div>
        </div>
        <div class="controls">
            <div id="time">7:15 AM</div>
            <div id="money">ยง4,668</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <script>
        // Constants
        const GRID_SIZE = 1;
        const CHARACTER_SPEED = 2; // Units per second
        
        // Scene setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB); // Sky blue
        
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(10, 10, 10);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);
        
        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 10, 5);
        directionalLight.castShadow = true;
        directionalLight.shadow.mapSize.width = 1024;
        directionalLight.shadow.mapSize.height = 1024;
        scene.add(directionalLight);
        
        // Grid helper (for development)
        const gridHelper = new THREE.GridHelper(20, 20);
        scene.add(gridHelper);
        
        // Create ground
        const groundGeometry = new THREE.PlaneGeometry(20, 20);
        const groundMaterial = new THREE.MeshStandardMaterial({ 
            color: 0x8BC34A, // Green
            side: THREE.DoubleSide
        });
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);
        
        // Create a simple house
        function createHouse() {
            const house = new THREE.Group();
            
            // Floor
            const floorGeometry = new THREE.BoxGeometry(5, 0.2, 5);
            const floorMaterial = new THREE.MeshStandardMaterial({ color: 0xB97A57 }); // Brown
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.position.y = 0.1;
            floor.receiveShadow = true;
            house.add(floor);
            
            // Walls
            const wallMaterial = new THREE.MeshStandardMaterial({ color: 0xF5F5DC }); // Beige
            
            // Back wall
            const backWallGeometry = new THREE.BoxGeometry(5, 2, 0.2);
            const backWall = new THREE.Mesh(backWallGeometry, wallMaterial);
            backWall.position.set(0, 1.1, -2.4);
            backWall.castShadow = true;
            house.add(backWall);
            
            // Left wall
            const leftWallGeometry = new THREE.BoxGeometry(0.2, 2, 5);
            const leftWall = new THREE.Mesh(leftWallGeometry, wallMaterial);
            leftWall.position.set(-2.4, 1.1, 0);
            leftWall.castShadow = true;
            house.add(leftWall);
            
            // Right wall (partial)
            const rightWallGeometry = new THREE.BoxGeometry(0.2, 2, 3);
            const rightWall = new THREE.Mesh(rightWallGeometry, wallMaterial);
            rightWall.position.set(2.4, 1.1, -1);
            rightWall.castShadow = true;
            house.add(rightWall);
            
            // Front wall (partial)
            const frontWallGeometry = new THREE.BoxGeometry(3, 2, 0.2);
            const frontWall = new THREE.Mesh(frontWallGeometry, wallMaterial);
            frontWall.position.set(-1, 1.1, 2.4);
            frontWall.castShadow = true;
            house.add(frontWall);
            
            // Furniture - TV
            const tvStandGeometry = new THREE.BoxGeometry(1, 0.5, 0.5);
            const tvStandMaterial = new THREE.MeshStandardMaterial({ color: 0x5D4037 }); // Dark brown
            const tvStand = new THREE.Mesh(tvStandGeometry, tvStandMaterial);
            tvStand.position.set(0, 0.35, -1.5);
            tvStand.castShadow = true;
            house.add(tvStand);
            
            const tvGeometry = new THREE.BoxGeometry(0.8, 0.6, 0.1);
            const tvMaterial = new THREE.MeshStandardMaterial({ color: 0x212121 }); // Dark grey
            const tv = new THREE.Mesh(tvGeometry, tvMaterial);
            tv.position.set(0, 0.9, -1.5);
            tv.castShadow = true;
            house.add(tv);
            
            // Furniture - Sofa
            const sofaBaseGeometry = new THREE.BoxGeometry(2, 0.3, 0.8);
            const sofaBaseMaterial = new THREE.MeshStandardMaterial({ color: 0xCFD8DC }); // Light grey
            const sofaBase = new THREE.Mesh(sofaBaseGeometry, sofaBaseMaterial);
            sofaBase.position.set(0, 0.25, -0.5);
            sofaBase.castShadow = true;
            house.add(sofaBase);
            
            const sofaBackGeometry = new THREE.BoxGeometry(2, 0.6, 0.2);
            const sofaBack = new THREE.Mesh(sofaBackGeometry, sofaBaseMaterial);
            sofaBack.position.set(0, 0.6, -0.85);
            sofaBack.castShadow = true;
            house.add(sofaBack);
            
            return house;
        }
        
        const house = createHouse();
        house.position.set(-3, 0, -3);
        scene.add(house);
        
        // Create character
        function createCharacter() {
            const character = new THREE.Group();
            
            // Body
            const bodyGeometry = new THREE.CylinderGeometry(0.25, 0.25, 0.8, 8);
            const bodyMaterial = new THREE.MeshStandardMaterial({ color: 0x2196F3 }); // Blue
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 0.4;
            body.castShadow = true;
            character.add(body);
            
            // Head
            const headGeometry = new THREE.SphereGeometry(0.25, 16, 16);
            const headMaterial = new THREE.MeshStandardMaterial({ color: 0xFFE0B2 }); // Skin color
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 0.95;
            head.castShadow = true;
            character.add(head);
            
            // Arms
            const armGeometry = new THREE.BoxGeometry(0.1, 0.4, 0.1);
            const armMaterial = new THREE.MeshStandardMaterial({ color: 0x2196F3 }); // Blue
            
            const leftArm = new THREE.Mesh(armGeometry, armMaterial);
            leftArm.position.set(-0.3, 0.5, 0);
            leftArm.castShadow = true;
            character.add(leftArm);
            
            const rightArm = new THREE.Mesh(armGeometry, armMaterial);
            rightArm.position.set(0.3, 0.5, 0);
            rightArm.castShadow = true;
            character.add(rightArm);
            
            // Legs
            const legGeometry = new THREE.BoxGeometry(0.1, 0.4, 0.1);
            const legMaterial = new THREE.MeshStandardMaterial({ color: 0x424242 }); // Dark grey
            
            const leftLeg = new THREE.Mesh(legGeometry, legMaterial);
            leftLeg.position.set(-0.15, 0.05, 0);
            leftLeg.castShadow = true;
            character.add(leftLeg);
            
            const rightLeg = new THREE.Mesh(legGeometry, legMaterial);
            rightLeg.position.set(0.15, 0.05, 0);
            rightLeg.castShadow = true;
            character.add(rightLeg);
            
            return character;
        }
        
        const character = createCharacter();
        character.position.set(0, 0, 0);
        scene.add(character);
        
        // Character movement animation
        let isMoving = false;
        let targetPosition = new THREE.Vector3();
        
        function moveCharacter(targetPos) {
            if (isMoving) return;
            
            isMoving = true;
            targetPosition.copy(targetPos);
            
            // Make sure character stays on the ground
            targetPosition.y = character.position.y;
            
            // Calculate distance and duration based on speed
            const distance = character.position.distanceTo(targetPosition);
            const duration = (distance / CHARACTER_SPEED) * 1000; // Convert to milliseconds
            
            // Look at target
            const lookAtPos = targetPosition.clone();
            lookAtPos.y = character.position.y;
            character.lookAt(lookAtPos);
            
            // Animate movement
            new TWEEN.Tween(character.position)
                .to({
                    x: targetPosition.x,
                    z: targetPosition.z
                }, duration)
                .easing(TWEEN.Easing.Quadratic.InOut)
                .onComplete(() => {
                    isMoving = false;
                    decreaseStats();
                })
                .start();
        }
        
        // Click handler for movement
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        
        function onMouseClick(event) {
            // Calculate mouse position in normalized device coordinates
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            // Update the picking ray with the camera and mouse position
            raycaster.setFromCamera(mouse, camera);
            
            // Calculate objects intersecting the picking ray
            const intersects = raycaster.intersectObjects([ground]);
            
            if (intersects.length > 0) {
                moveCharacter(intersects[0].point);
            }
        }
        
        window.addEventListener('click', onMouseClick, false);
        
        // Camera controls
        let cameraRotationSpeed = 0.02;
        let cameraDistance = 15;
        let cameraAngle = 0;
        let cameraHeight = 10;
        
        function updateCameraPosition() {
            const x = character.position.x + Math.sin(cameraAngle) * cameraDistance;
            const z = character.position.z + Math.cos(cameraAngle) * cameraDistance;
            
            camera.position.set(x, cameraHeight, z);
            camera.lookAt(character.position);
        }
        
        // Keyboard controls
        const keysPressed = {};
        
        window.addEventListener('keydown', (event) => {
            keysPressed[event.key] = true;
        });
        
        window.addEventListener('keyup', (event) => {
            keysPressed[event.key] = false;
        });
        
        function handleCameraControls() {
            // Rotate camera left
            if (keysPressed['a'] || keysPressed['A'] || keysPressed['ArrowLeft']) {
                cameraAngle += cameraRotationSpeed;
            }
            
            // Rotate camera right
            if (keysPressed['d'] || keysPressed['D'] || keysPressed['ArrowRight']) {
                cameraAngle -= cameraRotationSpeed;
            }
            
            // Move camera forward (zoom in)
            if (keysPressed['w'] || keysPressed['W'] || keysPressed['ArrowUp']) {
                cameraDistance = Math.max(5, cameraDistance - 0.1);
            }
            
            // Move camera backward (zoom out)
            if (keysPressed['s'] || keysPressed['S'] || keysPressed['ArrowDown']) {
                cameraDistance = Math.min(20, cameraDistance + 0.1);
            }
            
            updateCameraPosition();
        }
        
        // Mouse wheel for zoom
        window.addEventListener('wheel', (event) => {
            cameraDistance += event.deltaY * 0.01;
            cameraDistance = Math.max(5, Math.min(20, cameraDistance));
            updateCameraPosition();
        });
        
        // Window resize handler
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // Character needs stats
        const stats = {
            hunger: 75,
            energy: 60,
            fun: 40,
            social: 55
        };
        
        function updateStatsUI() {
            document.getElementById('hunger-bar').style.width = `${stats.hunger}%`;
            document.getElementById('energy-bar').style.width = `${stats.energy}%`;
            document.getElementById('fun-bar').style.width = `${stats.fun}%`;
            document.getElementById('social-bar').style.width = `${stats.social}%`;
        }
        
        function decreaseStats() {
            stats.hunger = Math.max(0, stats.hunger - 2);
            stats.energy = Math.max(0, stats.energy - 1);
            stats.fun = Math.max(0, stats.fun - 1.5);
            stats.social = Math.max(0, stats.social - 1);
            updateStatsUI();
        }
        
        // Game time
        let gameMinutes = 435; // 7:15 AM (435 minutes from midnight)
        const minutesPerSecond = 2; // Game time passes faster than real time
        
        function updateGameTime() {
            gameMinutes += minutesPerSecond * (1/60); // Update based on frame rate
            if (gameMinutes >= 1440) {
                gameMinutes -= 1440; // Reset after 24 hours
            }
            
            const hours = Math.floor(gameMinutes / 60);
            const minutes = Math.floor(gameMinutes % 60);
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const hours12 = hours % 12 || 12; // Convert to 12-hour format
            
            document.getElementById('time').textContent = 
                `${hours12}:${minutes.toString().padStart(2, '0')} ${ampm}`;
        }
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            TWEEN.update();
            handleCameraControls();
            updateGameTime();
            
            renderer.render(scene, camera);
        }
        
        // Initialize camera position
        updateCameraPosition();
        updateStatsUI();
        animate();
    </script>
</body>
</html>
